# 微信公众号文章发布工具 - 使用说明

## 概述

这是一个本地文件监控脚本，可以自动将Markdown文章发布到微信公众号草稿箱。文章和图片都放在同一个目录中，方便管理。

## 功能特点

✅ **自动监控**：监控指定目录的文件变化，自动发布新文章
✅ **统一目录**：文章和图片放在同一个目录中
✅ **智能识别**：自动识别文章和图片文件
✅ **错误处理**：完善的错误处理和日志记录
✅ **文件管理**：已处理的文件自动移动到processed目录

## 安装和配置

### 1. 设置环境变量

```bash
export WECHAT_APP_ID=your_app_id
export WECHAT_APP_SECRET=your_app_secret
```

### 2. 安装依赖

```bash
npm install
```

### 3. 编译代码

```bash
npm run build
```

## 使用方法

### 启动监控

```bash
# 方法1：使用启动脚本（推荐）
./start-publisher.sh

# 方法2：直接运行
node publish-monitor.js
```

### 目录结构

```
~/Desktop/Articles/
├── my-article.md          # 文章文件
├── cover-image.jpg        # 封面图片
├── other-image.png        # 其他图片
└── processed/             # 已处理的文件
    ├── my-article.md
    └── cover-image.jpg
```

### 文章格式

文章必须包含正确的frontmatter格式：

```markdown
---
title: 文章标题
cover: cover-image.jpg
theme: orangeheart  # 可选
---

文章内容...
```

### 支持的格式

- **文章格式**：`.md`
- **图片格式**：`.jpg`, `.jpeg`, `.png`, `.gif`

## 工作流程

1. **监控目录**：脚本持续监控 `~/Desktop/Articles/` 目录
2. **检测文件**：当检测到新的 `.md` 文件时，开始处理
3. **解析文章**：读取文章内容，解析frontmatter
4. **查找封面**：根据cover字段查找对应的图片文件
5. **发布文章**：调用微信公众号API发布到草稿箱
6. **移动文件**：将已处理的文件移动到 `processed/` 目录

## 注意事项

### 网络环境
- 发布前请关闭VPN以确保IP稳定
- 确保当前IP已添加到微信公众号IP白名单

### 文件命名
- 封面图片路径使用相对路径（相对于article目录）
- 图片文件必须存在于article目录中

### 错误处理
- 发布失败的文件会保留在原目录
- 所有操作日志都会在终端显示

## 故障排除

### 常见问题

1. **IP白名单错误**
   ```bash
   # 查看当前IP
   curl ifconfig.me
   ```

2. **权限错误**
   ```bash
   # 检查目录权限
   ls -la ~/Desktop/Articles/
   ```

3. **环境变量未设置**
   ```bash
   # 检查环境变量
   echo $WECHAT_APP_ID
   echo $WECHAT_APP_SECRET
   ```

### 日志查看

脚本运行时会显示详细的日志信息：
- ✅ 成功操作
- ❌ 错误信息
- ⚠️ 警告信息
- 📝 处理进度

## 高级配置

### 修改配置

编辑 `config.json` 文件来自定义配置：

```json
{
  "articleDir": "/Users/dabaobaodemac/Desktop/Articles",
  "processedDir": "/Users/dabaobaodemac/Desktop/Articles/processed",
  "themes": {
    "default": "default",
    "vibrant": "orangeheart",
    "colorful": "rainbow"
  },
  "autoPublish": true,
  "backupEnabled": true
}
```

### 自定义目录

修改 `publish-monitor.js` 中的配置：

```javascript
const ARTICLE_DIR = '/your/custom/path';
const PROCESSED_DIR = '/your/custom/path/processed';
```

## 停止监控

按 `Ctrl+C` 停止监控脚本。

## 示例

### 创建文章

1. 在 `~/Desktop/Articles/` 目录中创建 `my-article.md`：

```markdown
---
title: 我的第一篇文章
cover: my-cover.jpg
---

# 文章标题

这是文章内容...
```

2. 将封面图片 `my-cover.jpg` 放在同一目录中

3. 保存文件，脚本会自动检测并发布

### 查看结果

发布成功后，文件会移动到 `processed/` 目录，您可以在微信公众号后台查看草稿箱。

## 技术支持

如果遇到问题，请检查：
1. 网络连接是否正常
2. 环境变量是否正确设置
3. 文件格式是否符合要求
4. 微信公众号配置是否正确 